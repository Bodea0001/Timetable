# USER

## Токен

### Создание токена

Токен создаётся с помощью:

1. словарь с информацией, куда входят:
    - “sub”: {email пользователя}
    - “exp”: {время жизни токена}
    (для access токена - 30 минут,
    для refresh токена - 60 дней)
2.  секретный ключ
3. алгоритм

### Получение информации из токена

1. Токен декодируется
    - если токен не проходит валидацию (истек срок жизни или неправильный токен), то вырбасывается ошибка 401;
    - если токен проходит валидатцию , но в нём нет информации, то выбрасывается ошибка 401;
2. Возвращается декодированная в токене информация (то, что находится в “sub”)

## Аутентификация

### Создание аккаунта

1. При создании аккаунта на адрес *https://{domain}/register* клиент(фронтенд) передаёт поля:
    - “username”(email)
    - “password”
    - “first_name”
    - “last_name”
2. Затем бэкенд:
    - проверяет, валидный ли username(email); 
    если username(email) не валидный, то выбрасывает ошибку 400
    - не зарегистрирован ли аккаунт на переданный username(email); 
    если аккаунт на переданный username(email) зарегистрирован аккаунт, то выбрасывает ошибку 403
    - хэширует пароль;
    - с помощью переданных данных создает в БД пользователя;
    - создает access token со сроком жизни в 30 минут;
    - создает refresh token со сроком жизни в 60 дней;
    - сохраняет созданный refresh token в БД;
    - заносит ip в белый список ip пользователя (белый список ip нужен, чтобыв случае кражи токенов хакеру (лицу, завладевшему токенами) было сложнее ими воспользоваться).
3. В конце бэкенд отдает клиенту(фронтенду):
    - “access_token”
    - “refresh_token”
    - “token_type”(”token_type”: “bearer”).

### Вход в аккаунт

1. При входе в аккаунт на адрес *https://{domain}/login* клиент(фронтенд) передает:
    - “username”(email)
    - “password”
2. Затем бэкенд:
    - проверяет, есть ли пользователь с переданными данными;
    если пользователя нет в БД, то выбрасывается ошибка 401;
    - проверяет, сколько у пользователя refresh токенов;
    если у пользователя больше 10 refresh токенов, то удаляются все refresh токены (необходимо для обеспечения большей безопасности);
    - создает access token со сроком жизни в 30 минут;
    - создает refresh token со сроком жизни в 60 дней;
    - сохраняет созданный refresh token в БД;
    - заносит ip в белый список ip пользователя, если его (ip) там не было (белый список ip нужен, чтобыв случае кражи токенов хакеру (лицу, завладевшему токенами) было сложнее ими воспользоваться).
3. В конце бэкенд отдает клиенту(фронтенду):
    - “access_token”
    - “refresh_token”
    - “token_type”(”token_type”: “bearer”).

### Обновление токенов

1. Для обновления токенов на адрес *https://{domain}/refresh* клиент(фронтенд) передает:
    - “refresh_token”
2. Затем бэкенд:
    - получает информацию о пользователе с помощью токена
    (см. User - Токен);
    - проверяет, если текущий ip есть в белом списке ip;
    если его нет, то выбрасывает ошибку 404;
    - проверяет, есть ли переданный refresh токен у пользователя в БД;
    если нет, то выбрасывает ошибку 404;
    - проверяет, сколько у пользователя refresh токенов;
    если у пользователя больше 10 refresh токенов, то удаляются все refresh токены (необходимо для обеспечения большей безопасности);
    если меньше 10, то удаляется только переданный refresh токен;
    - создает  новый access token со сроком жизни в 30 минут;
    - создает новый refresh token со сроком жизни в 60 дней;
    - сохраняет созданный refresh token в БД.
3. В конце бэкенд отдает клиенту(фронтенду):
    - “access_token”
    - “refresh_token”
    - “token_type”(”token_type”: “bearer”).

### Выход из аккаунта

1. Для выхода из аккаунта клиент(фронтенд) на адрес *https://{domain}/logout передаёт:*
    - refresh token
2. Затем бэкенд:
    - получает информацию о пользователе с помощью токена
    (см. User - Токен);
    - проверяет, есть ли переданный refresh токен у пользователя в БД;
    если нет, то выбрасывает ошибку 404;
    - удаляет переданный refresh token из БД.

### Изменение пароля

1. Чтобы изменить пароль сначала нужно перейти на адрес *https://{domain}/change/password/request* и передать:
    - “email”
    (почта пользователя, к которой привязан аккаунт)
    - “new_password”
    (новый пароль)
2. Затем бэкенд:
    - Проверяет, есть ли аккаунт с такой почтой есть в БД;
    если нет, то вызывает ошибку 404;
    - Проверяет, не совпадает ли новый пароль с предыдущим;
    если совпадает, то вызывает ошибку 409;
    - Хеширует пароль;
    - Создает заявку на смену пароля;
    - Создает токен (в токене находится id заявки и почта пользователя);
    - Отправляет на почту пользователя письмо с ссылкой на смену пароля.
3. Затем пользователь заходит на свою почту и переходит по ссылке https://{domain}/change/password/execute/{token}
4. Затем бэкенд:
    - Валидирует данные в токене;
    если не получилось декодировать токен, то вызывает ошибку 400;
    - Получает id заявки и почту пользователя из токена;
    если поля “id” или “email” пустые, то вызывает ошибку 400;
    - Получает заявку из БД;
    - Сверяет информацию в заявке и токене;
    если заявки с переданным id нет, то вызывает ошибку 400;
    если почта в токене и почта в заявке разные, то вызывает ошибку 400;
    - Получает информацию о пользователе;
    если пользователь не нашелся, то вызывает ошибку 404;
    - Обновляет пароль для аккаунта пользователя на тот, который был указан в заявке;
    - Удаляет все refresh токены из БД для данного пользователя;
    - Удаляет заявку на смену пароля для данного пользователя из БД.

## Информация о пользователе

### Просмотр информации

1. Чтобы просмотреть информацию о пользователе, клиент(фронтенд) на адрес *https://{domain}/user/get_info* передаёт:
    - access token
2. Затем бэкенд:
    - получает информацию о пользователе с помощью токена
3. В конце бэкенд отдаёт клиенту(фронтенду):
    - “id”
    (id пользователя)
    - “email”
    (почта(username) пользователя)
    - “first_name”
    (имя пользователя)
    - “last_name” 
    (фамилия пользователя)
    - “applications”
    (список из всех заявок пользователя, которые он отправлял)
        - “id”
        (id заявки)
        - “id_timetable”
        (id расписания, который указан в заявке)
        - “timetable_name”
        (наименование расписания)
        - “timetable_university”
        (университет в расписании)
        - “timetable_specialization_name”
        (наименование специальности в расписании)
        - “timetable_specialization_code”
        (код специальности в расписании)
        - “timetable_education_level”
        (уровень образования: Бакалавриат, Магистратура, Специалитет)
        (обязателен, если передан параметр “specialization_name”)
        - “timetable_course”
        (курс в расписании)
        - “creation_date”
        (дата создания заявки)
    - “timetables_info”
    (список из всех расписаний пользователя)
        - “id”
        (id расписания)
        - “name”
        (название расписания)
        - “university”
        (университет, прикрепленный к расписанию)
        - “specialization_name”
        (специальность, прикрепленную к расписанию)
        - “specialization_code”
        (код специальности, прикрепленный к расписанию)
        - “education_level”
        (уровень: ”Бакалавриат”, “Магистратура”, “Аспирантура”)
        - “course”
        (курс, прикрепленный к расписанию)
        - “user_status”
        (статус пользователя в этом расписании)
        - “upper_week_items”
        (список из предметов всех дней верхней недели)
            - “id”
            (id дня верхней недели)
            - “id_timetable”
            (id расписания)
            - “day”
            (день недели)
            - “subjects”
            (список предметов в этот день)
                - “id”
                (id предмета в этот день)
                - “id_upper_week”
                (id дня верхней недели)
                - “subject”
                (предмет)
                - “start_time”
                (время начала предмета)
                - “end_time”
                (время окончания предмета)
        - “lower_week_items”
        (список из предметов всех дней нижней недели)
            - “id”
            (id дня нижней недели)
            - “id_timetable”
            (id расписания)
            - “day”
            (день недели)
            - “subjects”
            (список предметов в этот день)
                - “id”
                (id предмета в этот день)
                - “id_lower_week”
                (id дня верхней недели)
                - “subject”
                (предмет)
                - “start_time”
                (время начала предмета)
                - “end_time”
                (время окончания предмета)
        - “tasks”
        (список из задач для пользователя в этом расписании)
            - “id_timetable”
            (id расписания)
            - “description”
            (описание задачи)
            - “deadline”
            (срок, до которого нужно выполнить задачу)
            - “subject”
            (предмет, для которого нужно выполнить задачу)
            - “id”
            (id задачи)
            - “tag”
            (тэг задачи: “один” или “все”)
            - “status”
            (статус выполнения задачи пользователем: “В процессе” или “Выполнено”)
            - “creation_date”
            (дата создания задачи)

### Изменение информации

1. Для изменения информации (first name, last name, tg username) клиент(фронтенд)  на адрес *https://{domain}/user/update* передает:
    - “first_name”
    (имя пользователя)
    - “last_name”
    (фамилия пользователя)
    - access_token
2. Затем бэкенд:
    - Обновляет информацию о пользователе
3. В конце бэкенд отдаёт клиенту(фронтенду):
    - “id”
    (id пользователя)
    - “email”
    (почта(username) пользователя)
    - “first_name”
    (имя пользователя)
    - “last_name” 
    (фамилия пользователя)
    - “applications”
    (список из всех заявок пользователя, которые он отправлял)
        - “id”
        (id заявки)
        - “id_timetable”
        (id расписания, который указан в заявке)
    - “timetables_info”
    (список из всех расписаний пользователя)
        - “id”
        (id расписания)
        - “name”
        (название расписания)
        - “university”
        (университет, прикрепленный к расписанию)
        - “specialization_name”
        (специальность, прикрепленную к расписанию)
        - “specialization_code”
        (код специальности, прикрепленный к расписанию)
        - “education_level”
        (уровень: ”Бакалавриат”, “Магистратура”, “Аспирантура”)
        - “course”
        (курс, прикрепленный к расписанию)
        - “user_status”
        (статус пользователя в этом расписании)
        - “upper_week_items”
        (список из предметов всех дней верхней недели)
            - “id”
            (id дня верхней недели)
            - “id_timetable”
            (id расписания)
            - “day”
            (день недели)
            - “subjects”
            (список предметов в этот день)
                - “id”
                (id предмета в этот день)
                - “id_upper_week”
                (id дня верхней недели)
                - “subject”
                (предмет)
                - “start_time”
                (время начала предмета)
                - “end_time”
                (время окончания предмета)
        - “lower_week_items”
        (список из предметов всех дней нижней недели)
            - “id”
            (id дня нижней недели)
            - “id_timetable”
            (id расписания)
            - “day”
            (день недели)
            - “subjects”
            (список предметов в этот день)
                - “id”
                (id предмета в этот день)
                - “id_lower_week”
                (id дня верхней недели)
                - “subject”
                (предмет)
                - “start_time”
                (время начала предмета)
                - “end_time”
                (время окончания предмета)
        - “tasks”
        (список из задач для пользователя в этом расписании)
            - “id_timetable”
            (id расписания)
            - “description”
            (описание задачи)
            - “deadline”
            (срок, до которого нужно выполнить задачу)
            - “subject”
            (предмет, для которого нужно выполнить задачу)
            - “id”
            (id задачи)
            - “tag”
            (тэг задачи: “один” или “все”)
            - “status”
            (статус выполнения задачи пользователем: “В процессе” или “Выполнено”)
            - “creation_date”
            (дата создания задачи)

## Заявки на добавление расписания

### Подача заявки

1. Для добавления расписания к пользователю клиент(фронденд) на адрес *https://{domain}/application/sumbit* передает:
    - “timetable_id”
    - access token
2. Затем бэкенд:
    - проверяет, существует ли расписание с таким id;
    если не такого расписания не существует, то выбрасывает ошибку 404;
    - проверяет, есть ли у данного пользователя уже это расписание;
    если есть, то выбрасывает ошибку 403;
    - проверяет, подавал ли данный пользователь заявку на добавление этого расписания ранее;
    если подавал, то выбрасывает ошибку 403;
    - создаёт заявку в БД.

### Удаление заявки

1. Для удаления заявки клиент(фронтенд) на адрес *https://{domain}/application/delete* передаёт:
    - “application_id” (id заявки)
    - access token
2. Затем бэкенд:
    - проверяет, существует ли такая заявка у пользователя;
    если у пользователя такой заявки нет, то выбрасывает ошибку 404;
    - удаляет переданную заявку из БД.

### Просмотр всех заявок (поданных пользователем)

**1 Вариант**

Чтобы просмотреть все поданные заявки, клиент(фронтенд) может обратиться на адрес *https://{domain}/users/me* 

(Больше информации: USER - Информация о пользователе - Просмотр информации)

**2 Вариант**

1. Чтобы просмотреть все поданные заявки, клиент(фронтенд) на адрес *https://{domain}/application/get_all_submitted* передаёт:
    - access token
2. Затем бэкенд:
    - получает информацию о пользователе с помощью токена
3. В конце бэкенд отдаёт клиенту(фронтенду):
    - “applications”
    (список из всех заявок пользователя, которые он отправлял)
        - “id”
        (id заявки)
        - “id_timetable”
        (id расписания, который указан в заявке)
        - “timetable_name”
        (наименование расписания)
        - “timetable_university”
        (университет в расписании)
        - “timetable_specialization_name”
        (наименование специальности в расписании)
        - “timetable_specialization_code”
        (код специальности в расписании)
        - “timetable_education_level”
        (уровень образования: Бакалавриат, Магистратура, Специалитет)
        (обязателен, если передан параметр “specialization_name”)
        - “timetable_course”
        (курс в расписании)
        - “creation_date”
        (дата создания заявки)

### Просмотр всех заявок (на одобрение или отклонение)

1. Перед тем, как пользователь сможет одобрить или отклонить заявки, ему необходимо их увидеть. Для этого клиент(фронденд) на адрес *https://{domain}/application/get_all_for_consideration* передаёт:
    - access token
2. Затем бэкенд:
    - получает расписания, в которых текущий пользователь является старостой;
    если таких расписаний нет, то выбрасывает ошибку 404;
    - смотрит заявки к каждому расписанию, в котором пользователь является старостой.
3. В конце бэкенд отдаёт клиенту(фронтенду) список из всех заявок, а именно:
    - “id”
    (id заявки)
    - “user_email”
    (почта пользователя, отправившего заявку)
    - “user_first_name”
    (имя пользователя, отправившего заявку)
    - “user_last_name”
    (фамилия пользователя, отправившего заявку)
    - “id_timetable”
    - “creation_date”

### Одобрение заявки

1. Для одобрения заявки клиент(фронтенд) на адрес *https://{domain}/application/accept* передаёт:
    - “application_id” (id заявки)
    - access token
2. Затем бэкенд:
    - проверяет, существует ли такая заявка;
    если такой заявки не существует, то выбрасывает ошибку 404;
    - проверяет, что у пользователя, который одобряет заявку, есть расписание из переданной заявки;
    если нет, то выбрасывает ошибку 404;
    - проверяет, что для данного расписания пользователь, который одобряет заявку, является старостой;
    если нет, то выбрасывает ошибку 403;
    - удаляет переданную заявку из БД;
    - проверяет, что у пользователя, который подал заявку, меньше 10 расписаний;
    если больше, то выбрасывает ошибку 403;
    - проверяет, что у пользователя, который подал заявку, нет расписания из заявки;
    если есть, то выбрасывает ошибку 403;
    - добавляет расписание из заявки к пользователю, который подал заявку;
    - добавляет все задачи с тегом “все” в расписании к пользователю, который подал заявку.

### Отклонение заявки

1. Для отклонения заявки клиент(фронтенд) на адрес *https://{domain}/application/reject* передаёт:
    - “application_id” (id заявки)
    - access token
2. Затем бэкенд:
    - проверяет, существует ли такая заявка;
    если такой заявки не существует, то выбрасывает ошибку 404;
    - проверяет, что у пользователя, который одобряет заявку, есть расписание из переданной заявки;
    если нет, то выбрасывает ошибку 404;
    - проверяет, что для данного расписания пользователь, который одобряет заявку, является старостой;
    если нет, то выбрасывает ошибку 403;
    - удаляет переданную заявку из БД.

# TIMETABLE

## Создание расписания

1. Для создания расписания клиент(фронтенд) на адрес *https://{domain}/timetable/create* передаёт: 
    - “form_data”
    (форма с информацией для создания расписания)
        - “name”
        (наименование расписания)
        - “university”
        (университет для расписания)
        - “specialization_name”
        (наименование специальности для расписания)
        (может передоваться либо наименование специальности, либо код специальности)
        (если передаётся наименование специальности, то должен также передоваться также параметр ”education_level”(уровень образования))
        - “specialization_code”
        (код специальности для расписания)
        (может передоваться либо наименование специальности, либо код специальности)
        - “education_level”
        (уровень образования: Бакалавриат, Магистратура, Специалитет)
        - “course”
        (курс)
    - access token
2. Затем бэкенд: 
    - Проверяет, не превысит ли пользователь свой лимит расписаний, если создаст новое расписание (у пользователя может быть не больше 10 расписаний);
    если превысит лимит, то вызывает ошибку 403;
    - Проверяет, есть ли переданный университет в БД;
    если нет, то вызывает ошибку 400;
    - Проверяет специальность
        - Если уровень образования передан, то проверяет, является ли уровень образования одним из значений: Бакалавриат, Магистратура, Специалитет;
        если нет, то вызывает ошибку 400;
        - Смотрит, если переданы наименование специальности и уровень образовения (”specialization_name”, “education_level”);
        если переданы, то ищет специальность в БД;
        если не находит, то вызывает ошибку 400;
        если хоть одно не передано, то идет дальше;
        - Смотрит, если передан код специальности (“specialization_code”);
        если передан, то ищет специальность в БД;
        если не находит, то вызывает ошибку 400;
        если не передан, то идет дальше;
        - Если передано наименование специальности (”specialization_name”), но не передан уровень образования (“education_level”), то вызывает ошибку 400;
        - Если не передан ни один из параметров (”specialization_name”, “specialization_code”, “education_level”), то вызывает ошибку 400.
    - Проверяет курс
        - Если уровень образования передан, то проверяет, является ли уровень образования одним из значений: Бакалавриат, Магистратура, Специалитет;
        если нет, то вызывает ошибку 400;
        (уровень образования в данном случае берется из специальности)
        - Если уровень образования не передан, то проверяет, находится ли курс в диапазоне между 1 и 5;
        - Если уровень образования - Бакалавриат, то проверяет, находится ли курс в диапазоне между 1 и 4;
        - Если уровень образования - Магистратура, то проверяет, находится ли курс в диапазоне между 1 и 2;
        - Если уровень образования - Специалитет, то проверяет, находится ли курс в диапазоне между 1 и 6;
        - Если одно из вышеперечисленных условий срабатывает, то вызывает ошибку 400.
    - Проверяет, есть ли у данного пользователя расписание с таким же именем;
    если есть, то вызывает ошибку 403;
    - Проверяет, если расписание с такими же данными (наименование, университет, специальность, курс);
    если расписание с такими же данными уже существует, то вызывает ошибку 403;
    - Создает расписание в БД;
    - Создает связь между расписанием и пользователем в БД.
    (создатель становится старостой для этого расписания)
3. В конце бэкенд отдает клиенту(фронтенду) информацию о созданном расписании, а именно:
    - “id”
    (id созданного расписания)
    - “name”
    (наиманование созданного расписания)
    - “university”
    (университет в созданном расписании)
    - “specialization_name”
    (наименование специальности в созданном расписании)
    - “specialization_code”
    (код специальности в созданном расписании)
    - “education_level”
    (уровень образования в созданном расписании: Бакалавриат, Магистратура, Специалитет)
    - “course”
    (курс в созданном расписании)
    - “creation_date”
    (дата создания созданного расписания)

## Заполнение расписания

### Заполнение недельного расписания

1. Для заполнения недельного расписания клиент(фронтенд) на адрес https://{domain}/timetable/week/create_week передает:
    - “timetable_id”
    (id расписания)
    - “week_name”
    (наименование недели: “верхняя” или “нижняя”)
    - “weekly_timetable”
    (список из предметов всех дней недели)
        - “day”
        (день недели)
        - “subjects”
        (список предметов в этот день)
            - “subject”
            (предмет)
            - “start_time”
            (время начала предмета)
            - “end_time”
            (время окончания предмета)
    - access token
2. Затем бэкенд:
    - Проверяет, есть ли переданное расписание у пользователя;
    если нет, то вызывает ошибку 404;
    - Проверяет, является ли пользователь старостой в этом расписании;
    если нет, то вызывает ошибку 403;
    - Проверяет, заполнено ли уже данное расписание для переданной недели (верхней или нижней);
    если заполнено, то вызывает ошибку 403;
    - Проверяет есть ли повторяющиеся дни в переданной неделе;
    если есть, то вызывает ошибку 409;
    - Упорядочивает предметы в каждом дне по начальному времени;
    - Проверяет в каждом дне переданной недели начальное и конечное время каждого предмета;
    если начальное время впереди идущего предмета меньше, чем конечное время текущего(на момент проверки) предмета или начальное время текущего(на момент проверки) предмета больше конечного времени текущего(на момент проверки) предмета, то вызывает ошибку 400;
    - создает расписание для переданной недели (верхней или нижней) в БД.
3. В конце бэкенд отдает клиенту(фронтенду) информацию о заполненном расписании, а именно:
    - “id”
    (id расписания)
    - “name”
    (название расписания)
    - “university”
    (университет, прикрепленный к расписанию)
    - “specialization_name”
    (специальность, прикрепленную к расписанию)
    - “specialization_code”
    (код специальности, прикрепленный к расписанию)
    - “education_level”
    (уровень: ”Бакалавриат”, “Магистратура”, “Аспирантура”)
    - “course”
    (курс, прикрепленный к расписанию)
    - “user_status”
    (статус пользователя в этом расписании)
    - “upper_week_items”
    (список из предметов всех дней верхней недели)
        - “id”
        (id дня верхней недели)
        - “id_timetable”
        (id расписания)
        - “day”
        (день недели)
        - “subjects”
        (список предметов в этот день)
            - “id”
            (id предмета в этот день)
            - “id_upper_week”
            (id дня верхней недели)
            - “subject”
            (предмет)
            - “start_time”
            (время начала предмета)
            - “end_time”
            (время окончания предмета)
    - “lower_week_items”
    (список из предметов всех дней нижней недели)
        - “id”
        (id дня нижней недели)
        - “id_timetable”
        (id расписания)
        - “day”
        (день недели)
        - “subjects”
        (список предметов в этот день)
            - “id”
            (id предмета в этот день)
            - “id_lower_week”
            (id дня верхней недели)
            - “subject”
            (предмет)
            - “start_time”
            (время начала предмета)
            - “end_time”
            (время окончания предмета)
    - “tasks”
    (список из задач для пользователя в этом расписании)
        - “id_timetable”
        (id расписания)
        - “description”
        (описание задачи)
        - “deadline”
        (срок, до которого нужно выполнить задачу)
        - “subject”
        (предмет, для которого нужно выполнить задачу)
        - “id”
        (id задачи)
        - “tag”
        (тэг задачи: “один” или “все”)
        - “status”
        (статус выполнения задачи пользователем: “В процессе” или “Выполнено”)
        - “creation_date”
        (дата создания задачи)

### Заполнение одного дня в расписании

1. Для заполнения одного дня в расписании клиент(фронтенд) на адрес https://{domain}/timetable/week/create_day передает:
    - “timetable_id”
    (id расписания)
    - “week_name”
    (наименование недели: “верхняя” или “нижняя”)
    - “daily_timetable”
    (наименование дня и список из предметов в этот день)
        - “day”
        (день недели)
        - “subjects”
        (список предметов в этот день)
            - “subject”
            (предмет)
            - “start_time”
            (время начала предмета)
            - “end_time”
            (время окончания предмета)
    - access token
2. Затем бэкенд:
    - Проверяет, есть ли переданное расписание у пользователя;
    если нет, то вызывает ошибку 404;
    - Проверяет, является ли пользователь старостой в этом расписании;
    если нет, то вызывает ошибку 403;
    - Проверяет, заполнено ли уже данное расписание для переданной недели (верхней или нижней);
    если заполнено, то вызывает ошибку 403;
    - Проверяет есть ли переданный день в переданной неделе (верхней или нижней);
    если есть, то вызывает ошибку 403;
    - Упорядочивает предметы в каждом дне по начальному времени;
    - Проверяет в переданном дне начальное и конечное время каждого предмета;
    если начальное время впереди идущего предмета меньше, чем конечное время текущего(на момент проверки) предмета или начальное время текущего(на момент проверки) предмета больше конечного времени текущего(на момент проверки) предмета, то вызывает ошибку 400;
    - создает расписание для переданного дня в переданной неделе (верхней или нижней) в БД.
3. В конце бэкенд отдает клиенту(фронтенду) информацию о заполненном расписании, а именно:
    - “id”
    (id расписания)
    - “name”
    (название расписания)
    - “university”
    (университет, прикрепленный к расписанию)
    - “specialization_name”
    (специальность, прикрепленную к расписанию)
    - “specialization_code”
    (код специальности, прикрепленный к расписанию)
    - “education_level”
    (уровень: ”Бакалавриат”, “Магистратура”, “Аспирантура”)
    - “course”
    (курс, прикрепленный к расписанию)
    - “user_status”
    (статус пользователя в этом расписании)
    - “upper_week_items”
    (список из предметов всех дней верхней недели)
        - “id”
        (id дня верхней недели)
        - “id_timetable”
        (id расписания)
        - “day”
        (день недели)
        - “subjects”
        (список предметов в этот день)
            - “id”
            (id предмета в этот день)
            - “id_upper_week”
            (id дня верхней недели)
            - “subject”
            (предмет)
            - “start_time”
            (время начала предмета)
            - “end_time”
            (время окончания предмета)
    - “lower_week_items”
    (список из предметов всех дней нижней недели)
        - “id”
        (id дня нижней недели)
        - “id_timetable”
        (id расписания)
        - “day”
        (день недели)
        - “subjects”
        (список предметов в этот день)
            - “id”
            (id предмета в этот день)
            - “id_lower_week”
            (id дня верхней недели)
            - “subject”
            (предмет)
            - “start_time”
            (время начала предмета)
            - “end_time”
            (время окончания предмета)
    - “tasks”
    (список из задач для пользователя в этом расписании)
        - “id_timetable”
        (id расписания)
        - “description”
        (описание задачи)
        - “deadline”
        (срок, до которого нужно выполнить задачу)
        - “subject”
        (предмет, для которого нужно выполнить задачу)
        - “id”
        (id задачи)
        - “tag”
        (тэг задачи: “один” или “все”)
        - “status”
        (статус выполнения задачи пользователем: “В процессе” или “Выполнено”)
        - “creation_date”
        (дата создания задачи)

### Заполнение одного предмета в расписании

1. Для заполнения одного предмета в расписании клиент(фронтенд) на адрес https://{domain}/timetable/week/create_subject передает:
    - “timetable_id”
    (id расписания)
    - “day_id”
    (id дня)
    - “week_name”
    (наименование недели: “верхняя” или “нижняя”)
    - “daily_subjects”
    (список предметов в этот день)
        - “subject”
        (предмет)
        - “start_time”
        (время начала предмета)
        - “end_time”
        (время окончания предмета)
    - access token
2. Затем бэкенд:
    - Проверяет, есть ли переданное расписание у пользователя;
    если нет, то вызывает ошибку 404;
    - Проверяет, является ли пользователь старостой в этом расписании;
    если нет, то вызывает ошибку 403;
    - Проверяет, заполнено ли уже данное расписание для переданной недели (верхней или нижней);
    если заполнено, то вызывает ошибку 403;
    - Проверяет есть ли переданный день в переданной неделе (верхней или нижней);
    если переданного дня или переданной недели (верхней или нижней) не существует, то вызывает ошибку 404;
    - Упорядочивает предметы в переданном дне по начальному времени;
    - Добавляет начальное и конечное время переданного предмета к переданному дню;
    если начальное или конечное время уже заняты, то вызывает ошибку 409;
    - Проверяет в переданном дне начальное и конечное время каждого предмета;
    если начальное время впереди идущего предмета меньше, чем конечное время текущего(на момент проверки) предмета или начальное время текущего(на момент проверки) предмета больше конечного времени текущего(на момент проверки) предмета, то вызывает ошибку 400;
    - создает предмет для переданного дня в переданной неделе (верхней или нижней) в БД.
3. В конце бэкенд отдает клиенту(фронтенду) информацию о заполненном расписании, а именно:
    - “id”
    (id расписания)
    - “name”
    (название расписания)
    - “university”
    (университет, прикрепленный к расписанию)
    - “specialization_name”
    (специальность, прикрепленную к расписанию)
    - “specialization_code”
    (код специальности, прикрепленный к расписанию)
    - “education_level”
    (уровень: ”Бакалавриат”, “Магистратура”, “Аспирантура”)
    - “course”
    (курс, прикрепленный к расписанию)
    - “user_status”
    (статус пользователя в этом расписании)
    - “upper_week_items”
    (список из предметов всех дней верхней недели)
        - “id”
        (id дня верхней недели)
        - “id_timetable”
        (id расписания)
        - “day”
        (день недели)
        - “subjects”
        (список предметов в этот день)
            - “id”
            (id предмета в этот день)
            - “id_upper_week”
            (id дня верхней недели)
            - “subject”
            (предмет)
            - “start_time”
            (время начала предмета)
            - “end_time”
            (время окончания предмета)
    - “lower_week_items”
    (список из предметов всех дней нижней недели)
        - “id”
        (id дня нижней недели)
        - “id_timetable”
        (id расписания)
        - “day”
        (день недели)
        - “subjects”
        (список предметов в этот день)
            - “id”
            (id предмета в этот день)
            - “id_lower_week”
            (id дня верхней недели)
            - “subject”
            (предмет)
            - “start_time”
            (время начала предмета)
            - “end_time”
            (время окончания предмета)
    - “tasks”
    (список из задач для пользователя в этом расписании)
        - “id_timetable”
        (id расписания)
        - “description”
        (описание задачи)
        - “deadline”
        (срок, до которого нужно выполнить задачу)
        - “subject”
        (предмет, для которого нужно выполнить задачу)
        - “id”
        (id задачи)
        - “tag”
        (тэг задачи: “один” или “все”)
        - “status”
        (статус выполнения задачи пользователем: “В процессе” или “Выполнено”)
        - “creation_date”
        (дата создания задачи)

## Просмотр всех расписаний пользователя

**1 Вариант**

Чтобы просмотреть все расписания пользователя, клиент(фронтенд) может обратиться на адрес *https://{domain}/users/me* 

(Больше информации: USER - Информация о пользователе - Просмотр информации)

**2 Вариант**

1. Чтобы просмотреть все расписания пользователя, клиент(фронтенд) на адрес *https://{domain}/timetable/get_user_timetable* передаёт:
    - access token
2. Затем бэкенд:
    - получает информацию о пользователе с помощью токена
3. В конце бэкенд отдаёт клиенту(фронтенду):
    - список из всех расписаний пользователя
        - “id”
        (id расписания)
        - “name”
        (название расписания)
        - “university”
        (университет, прикрепленный к расписанию)
        - “specialization_name”
        (специальность, прикрепленную к расписанию)
        - “specialization_code”
        (код специальности, прикрепленный к расписанию)
        - “education_level”
        (уровень: ”Бакалавриат”, “Магистратура”, “Аспирантура”)
        - “course”
        (курс, прикрепленный к расписанию)
        - “user_status”
        (статус пользователя в этом расписании)
        - “upper_week_items”
        (список из предметов всех дней верхней недели)
            - “id”
            (id дня верхней недели)
            - “id_timetable”
            (id расписания)
            - “day”
            (день недели)
            - “subjects”
            (список предметов в этот день)
                - “id”
                (id предмета в этот день)
                - “id_upper_week”
                (id дня верхней недели)
                - “subject”
                (предмет)
                - “start_time”
                (время начала предмета)
                - “end_time”
                (время окончания предмета)
        - “lower_week_items”
        (список из предметов всех дней нижней недели)
            - “id”
            (id дня нижней недели)
            - “id_timetable”
            (id расписания)
            - “day”
            (день недели)
            - “subjects”
            (список предметов в этот день)
                - “id”
                (id предмета в этот день)
                - “id_lower_week”
                (id дня верхней недели)
                - “subject”
                (предмет)
                - “start_time”
                (время начала предмета)
                - “end_time”
                (время окончания предмета)
        - “tasks”
        (список из задач для пользователя в этом расписании)
            - “id_timetable”
            (id расписания)
            - “description”
            (описание задачи)
            - “deadline”
            (срок, до которого нужно выполнить задачу)
            - “subject”
            (предмет, для которого нужно выполнить задачу)
            - “id”
            (id задачи)
            - “tag”
            (тэг задачи: “один” или “все”)
            - “status”
            (статус выполнения задачи пользователем: “В процессе” или “Выполнено”)
            - “creation_date”
            (дата создания задачи)

## Изменение общей информации о расписании

1. Для изменения общей информации о расписании (наименование, университет, специальность, курс) клиент(фронтенд) на адрес *https://{domain}/timetable/update* передаёт:
    - “timetable_id”
    (id расписания)
    - “form_data”
    (форма с информацией для изменения расписания)
        - “name”
        (наименование расписания)
        - “university”
        (университет для расписания)
        - “specialization_name”
        (наименование специальности для расписания)
        (может передоваться либо наименование специальности, либо код специальности)
        (если передаётся наименование специальности, то должен также передоваться также параметр ”education_level”(уровень образования))
        - “specialization_code”
        (код специальности для расписания)
        (может передоваться либо наименование специальности, либо код специальности)
        - “education_level”
        (уровень образования: Бакалавриат, Магистратура, Специалитет)
        - “course”
        (курс)
    - access token
2. Затем бэкенд:
    - Проверяет, есть ли переданное расписание у пользователя;
    если нет, то вызывает ошибку 404;
    - Проверяет, является ли пользователь старостой в этом расписании;
    если нет, то вызывает ошибку 403;
    - Проверяет, есть ли переданный университет в БД;
    если нет, то вызывает ошибку 400;
    - Проверяет специальность
        - Если уровень образования передан, то проверяет, является ли уровень образования одним из значений: Бакалавриат, Магистратура, Специалитет;
        если нет, то вызывает ошибку 400;
        - Смотрит, если переданы наименование специальности и уровень образовения (”specialization_name”, “education_level”);
        если переданы, то ищет специальность в БД;
        если не находит, то вызывает ошибку 400;
        если хоть одно не передано, то идет дальше;
        - Смотрит, если передан код специальности (“specialization_code”);
        если передан, то ищет специальность в БД;
        если не находит, то вызывает ошибку 400;
        если не передан, то идет дальше;
        - Если передано наименование специальности (”specialization_name”), но не передан уровень образования (“education_level”), то вызывает ошибку 400;
        - Если не передан ни один из параметров (”specialization_name”, “specialization_code”, “education_level”), то вызывает ошибку 400.
    - Проверяет курс
        - Если уровень образования передан, то проверяет, является ли уровень образования одним из значений: Бакалавриат, Магистратура, Специалитет;
        если нет, то вызывает ошибку 400;
        (уровень образования в данном случае берется из специальности)
        - Если уровень образования не передан, то проверяет, находится ли курс в диапазоне между 1 и 5;
        - Если уровень образования - Бакалавриат, то проверяет, находится ли курс в диапазоне между 1 и 4;
        - Если уровень образования - Магистратура, то проверяет, находится ли курс в диапазоне между 1 и 2;
        - Если уровень образования - Специалитет, то проверяет, находится ли курс в диапазоне между 1 и 6;
        - Если одно из вышеперечисленных условий срабатывает, то вызывает ошибку 400.
    - Проверяет, есть ли у данного пользователя расписание с таким же именем;
    если есть, то вызывает ошибку 403;
    - Проверяет, если расписание с такими же данными (наименование, университет, специальность, курс);
    если расписание с такими же данными уже существует, то вызывает ошибку 403;
    - Обновляет информацию о расписании в БД;
3. В конце бэкенд отдает клиенту(фронтенду) информацию об измененном расписании, а именно:
    - “id”
    (id расписания)
    - “name”
    (название расписания)
    - “university”
    (университет, прикрепленный к расписанию)
    - “specialization_name”
    (специальность, прикрепленную к расписанию)
    - “specialization_code”
    (код специальности, прикрепленный к расписанию)
    - “education_level”
    (уровень: ”Бакалавриат”, “Магистратура”, “Аспирантура”)
    - “course”
    (курс, прикрепленный к расписанию)
    - “user_status”
    (статус пользователя в этом расписании)
    - “upper_week_items”
    (список из предметов всех дней верхней недели)
        - “id”
        (id дня верхней недели)
        - “id_timetable”
        (id расписания)
        - “day”
        (день недели)
        - “subjects”
        (список предметов в этот день)
            - “id”
            (id предмета в этот день)
            - “id_upper_week”
            (id дня верхней недели)
            - “subject”
            (предмет)
            - “start_time”
            (время начала предмета)
            - “end_time”
            (время окончания предмета)
    - “lower_week_items”
    (список из предметов всех дней нижней недели)
        - “id”
        (id дня нижней недели)
        - “id_timetable”
        (id расписания)
        - “day”
        (день недели)
        - “subjects”
        (список предметов в этот день)
            - “id”
            (id предмета в этот день)
            - “id_lower_week”
            (id дня верхней недели)
            - “subject”
            (предмет)
            - “start_time”
            (время начала предмета)
            - “end_time”
            (время окончания предмета)
    - “tasks”

## Изменение содержимого расписания

1. Для изменения недели, дня или предмета в расписании клиент(фронтенд) на адрес https://{domain}/timetable/week/update передает:
    - “timetable_id”
    (id расписания)
    - “week_name”
    (наименование недели: “верхняя” или “нижняя”)
    - “weekly_timetable”
    (список из предметов всех дней недели)
        - “day”
        (день недели)
        - “subjects”
        (список предметов в этот день)
            - “subject”
            (предмет)
            - “start_time”
            (время начала предмета)
            - “end_time”
            (время окончания предмета)
    - access token
2. Затем бэкенд:
    - Проверяет, есть ли переданное расписание у пользователя;
    если нет, то вызывает ошибку 404;
    - Проверяет, является ли пользователь старостой в этом расписании;
    если нет, то вызывает ошибку 403;
    - Проверяет, заполнено ли уже данное расписание для переданной недели (верхней или нижней);
    если не заполнено, то вызывает ошибку 404;
    - Проверяет переданные дни переданной недели (верхней или нижней);
    если есть повторяющиеся id дней, то вызывает ошибку 400;
    если в переданной недели нет переданного дня, тоо вызывает ошибку 404;
    - Проверяет переданные предметы для каждого переданного дня в переданной недели (верхней или нижней);
    если есть повторяющиеся id предметов, то вызывает ошибку 400;
    если в переданном дне переданной недели (верхней или нижней) нет такого предмета, то вызывает ошибку 404;
    - Проверяет есть ли повторяющиеся дни в переданной неделе;
    если есть, то вызывает ошибку 409;
    - Упорядочивает предметы в каждом дне по начальному времени;
    - Проверяет в каждом дне переданной недели начальное и конечное время каждого предмета;
    если начальное время впереди идущего предмета меньше, чем конечное время текущего(на момент проверки) предмета или начальное время текущего(на момент проверки) предмета больше конечного времени текущего(на момент проверки) предмета, то вызывает ошибку 400;
    - Изменяет расписание для переданной недели (верхней или нижней) в БД.
3. В конце бэкенд отдает клиенту(фронтенду) информацию о заполненном расписании, а именно:
    - “id”
    (id расписания)
    - “name”
    (название расписания)
    - “university”
    (университет, прикрепленный к расписанию)
    - “specialization_name”
    (специальность, прикрепленную к расписанию)
    - “specialization_code”
    (код специальности, прикрепленный к расписанию)
    - “education_level”
    (уровень: ”Бакалавриат”, “Магистратура”, “Аспирантура”)
    - “course”
    (курс, прикрепленный к расписанию)
    - “user_status”
    (статус пользователя в этом расписании)
    - “upper_week_items”
    (список из предметов всех дней верхней недели)
        - “id”
        (id дня верхней недели)
        - “id_timetable”
        (id расписания)
        - “day”
        (день недели)
        - “subjects”
        (список предметов в этот день)
            - “id”
            (id предмета в этот день)
            - “id_upper_week”
            (id дня верхней недели)
            - “subject”
            (предмет)
            - “start_time”
            (время начала предмета)
            - “end_time”
            (время окончания предмета)
    - “lower_week_items”
    (список из предметов всех дней нижней недели)
        - “id”
        (id дня нижней недели)
        - “id_timetable”
        (id расписания)
        - “day”
        (день недели)
        - “subjects”
        (список предметов в этот день)
            - “id”
            (id предмета в этот день)
            - “id_lower_week”
            (id дня верхней недели)
            - “subject”
            (предмет)
            - “start_time”
            (время начала предмета)
            - “end_time”
            (время окончания предмета)
    - “tasks”
    (список из задач для пользователя в этом расписании)
        - “id_timetable”
        (id расписания)
        - “description”
        (описание задачи)
        - “deadline”
        (срок, до которого нужно выполнить задачу)
        - “subject”
        (предмет, для которого нужно выполнить задачу)
        - “id”
        (id задачи)
        - “tag”
        (тэг задачи: “один” или “все”)
        - “status”
        (статус выполнения задачи пользователем: “В процессе” или “Выполнено”)
        - “creation_date”
        (дата создания задачи)

## Удаление расписания у себя

1. Для удаления расписания у себя клиент(фронтенд) на адрес *https://{domain}/timetable/delete_for_user* передаёт:
    - “timetable_id”
    (id расписания)
    - access token
2. Затем бэкенд:
    - Проверяет, есть ли переданное расписание у пользователя;
    если нет, то вызывает ошибку 404;
    - Проверяет, не является ли пользователь старостой для этого расписания;
    если является, то вызывает ошибку 403;
    (староста может удалить расписание только для всех)
    - Удаляет связь между пользователем и расписанием в БД.

## Удаление расписания у всех

1. Для удаления расписания у всех клиент(фронтенд) на адрес *https://{domain}/timetable/delete_for_all* передаёт:
    - “timetable_id”
    (id расписания)
    - access token
2. Затем бэкенд:
    - Проверяет, есть ли переданное расписание у пользователя;
    если нет, то вызывает ошибку 404;
    - Проверяет, является ли пользователь старостой в этом расписании;
    если нет, то вызывает ошибку 403;
    - Удаляет расписание в БД.

## Удаление содержимого расписания

### Удаление недельного расписания

1. Для удаления недельного расписания клиент(фронтенд) на адрес https://{domain}/timetable/week/delete_week передает:
    - “timetable_id”
    (id расписания)
    - “week_name”
    (наименование недели: “верхняя” или “нижняя”)
    - access token
2. Затем бэкенд:
    - Проверяет, есть ли переданное расписание у пользователя;
    если нет, то вызывает ошибку 404;
    - Проверяет, является ли пользователь старостой в этом расписании;
    если нет, то вызывает ошибку 403;
    - Проверяет, заполнено ли уже данное расписание для переданной недели (верхней или нижней);
    если не заполнено, то вызывает ошибку 404;
    - Удаляет расписание для переданной недели (верхней или нижней) из БД.

### Удаление одного дня в расписании

1. Для удаления дневного расписания клиент(фронтенд) на адрес https://{domain}/timetable/week/delete_day передает:
    - “timetable_id”
    (id расписания)
    - “day_id”
    (id дня)
    - “week_name”
    (наименование недели: “верхняя” или “нижняя”)
    - access token
2. Затем бэкенд:
    - Проверяет, есть ли переданное расписание у пользователя;
    если нет, то вызывает ошибку 404;
    - Проверяет, является ли пользователь старостой в этом расписании;
    если нет, то вызывает ошибку 403;
    - Проверяет, заполнено ли уже данное расписание для переданной недели (верхней или нижней);
    если не заполнено, то вызывает ошибку 404;
    - Проверяет есть ли переданный день в переданной неделе (верхней или нижней);
    если переданного дня или переданной недели (верхней или нижней) не существует, то вызывает ошибку 404;
    - Удаляет переданное дневное расписание для переданной недели (верхней или нижней) из БД.

### Удаление одного предмета в расписании

1. Для удаления одного предмета в расписании клиент(фронтенд) на адрес https://{domain}/timetable/week/delete_subject передает:
    - “timetable_id”
    (id расписания)
    - “subject_id”
    (id предмета)
    - “week_name”
    (наименование недели: “верхняя” или “нижняя”)
    - access token
2. Затем бэкенд:
    - Проверяет, есть ли переданное расписание у пользователя;
    если нет, то вызывает ошибку 404;
    - Проверяет, является ли пользователь старостой в этом расписании;
    если нет, то вызывает ошибку 403;
    - Проверяет, заполнено ли уже данное расписание для переданной недели (верхней или нижней);
    если не заполнено, то вызывает ошибку 404;
    - Проверяет есть ли переданный предмет в переданной неделе (верхней или нижней);
    если переданного предмета или переданной недели (верхней или нижней) не существует, то вызывает ошибку 404;
    - Удаляет переданный предмет в расписании для переданной недели (верхней или нижней) из БД.

## Поиск расписания

1. Для поиска расписания клиент(фронтенд) на адрес *https://{domain}/timetable/find* передает:
    - “name”
    (наименование расписания)
    - “university”
    (университет в расписании)
    - “specialization_name”
    (наименование специальности в расписании)
    - “specialization_code”
    (код специальности в расписании)
    - “education_level”
    (уровень образования: Бакалавриат, Магистратура, Специалитет)
    (обязателен, если передан параметр “specialization_name”)
    - “course”
    (курс в расписании)
    - “skip”
    (параметр, показывающий, сколько расписаний надо пропустить)
    
    Кроме параметра “skip”, все остальные параметры являются необязательными, но должен передаваться хотя бы один из параметров.
    
2. Затем бэкенд:
    - Проверяет, если передан хотя бы один из параметров (”name”, “university”, “specialization_name”, “specialization_code”, “course”);
    если не передан ни один из параметров, то вызывает ошибку 400;
    - Если передан параметр “specialization_name” или “specialization_code”, то проверяет специальность;
        - Если уровень образования передан, то проверяет, является ли уровень образования одним из значений: Бакалавриат, Магистратура, Специалитет;
        если нет, то вызывает ошибку 400;
        - Смотрит, если переданы наименование специальности и уровень образовения (”specialization_name”, “education_level”);
        если переданы, то ищет специальность в БД;
        если не находит, то вызывает ошибку 400;
        если хоть одно не передано, то идет дальше;
        - Смотрит, если передан код специальности (“specialization_code”);
        если передан, то ищет специальность в БД;
        если не находит, то вызывает ошибку 400;
        если не передан, то идет дальше;
        - Если передано наименование специальности (”specialization_name”), но не передан уровень образования (“education_level”), то вызывает ошибку 400.
    - Если передан курс, то проверяет курс;
        - Если уровень образования передан, то проверяет, является ли уровень образования одним из значений: Бакалавриат, Магистратура, Специалитет;
        если нет, то вызывает ошибку 400;
        (уровень образования в данном случае берется из специальности)
        - Если уровень образования не передан, то проверяет, находится ли курс в диапазоне между 1 и 5;
        - Если уровень образования - Бакалавриат, то проверяет, находится ли курс в диапазоне между 1 и 4;
        - Если уровень образования - Магистратура, то проверяет, находится ли курс в диапазоне между 1 и 2;
        - Если уровень образования - Специалитет, то проверяет, находится ли курс в диапазоне между 1 и 6;
        - Если одно из вышеперечисленных условий срабатывает, то вызывает ошибку 400.
    - Исходя из полученных параметров ищет расписания в БД;
    если не нашлось ни одного расписания, подходящего условию, то вызывает ошибку 404.
3. В конце бэкенд отдает клиенту(фронтенду) список из найденных расписаний, а именно:
    - “id”
    (id расписания)
    - “name”
    (наименование расписания)
    - “university”
    (университет в расписании)
    - “specialization_name”
    (наименование специальности в расписании)
    - “specialization_code”
    (код специальности в расписании)
    - “education_level”
    (уровень образования в расписании: Бакалавриат, Магистратура, Специалитет)
    - “course”
    (курс в расписании)
    - “creation_date”
    (дата создания расписания)

# TASK

## Создание задачи

### Создание задачи для одного пользователя в расписании

1. Для создания задачи для одного пользователя в расписании клиент(фронтенд) на адрес *https://{domain}/task/create_for_user* передает:
    - “user_id”
    (id ползьзователя, для которого нужно создать задачу)
    - “task”
    (данные для создания задачи)
        - “id_timetable”
        (id расписания)
        - “description”
        (описание задачи)
        - “deadline”
        (срок, до которого нужно выполнить задачу)
        - “subject”
        (предмет, для которого нужно выполнить задачу)
    - access token
2. Затем бэкенд:
    - Проверяет, есть ли переданное расписание у пользователя;
    если нет, то вызывает ошибку 404;
    - Проверяет, является ли пользователь старостой в этом расписании или совпадает ли “user_id” с пользователем, который хочет создать задачу;
    если не выполняется ни одно из условий, то вызывает ошибку 403;
    - Создаёт задачу для одного пользователя в БД.

### Создание задачи для всех пользователей в расписании

1. Для создания задачи для всех пользователей в расписании клиент(фронтенд) на адрес *https://{domain}/task/create_for_all* передает:
    - “task”
    (данные для создания задачи)
        - “id_timetable”
        (id расписания)
        - “description”
        (описание задачи)
        - “deadline”
        (срок, до которого нужно выполнить задачу)
        - “subject”
        (предмет, для которого нужно выполнить задачу)
    - access token
2. Затем бэкенд:
    - Проверяет, есть ли переданное расписание у пользователя;
    если нет, то вызывает ошибку 404;
    - Проверяет, является ли пользователь старостой в этом расписании ;
    если нет, то вызывает ошибку 403;
    - Создаёт задачу для одного пользователя в БД.

## Просмотр всех задач

### Просмотр всех задач пользователем для конретного расписания
(Видны только задачи для пользователя в конретном расписания)

**1 Вариант**

Чтобы просмотреть все задачи для конкретного расписания пользователя, клиент(фронтенд) может обратиться на адрес *https://{domain}/users/me* 

(Больше информации: USER - Информация о пользователе - Просмотр информации)

**2 Вариант**

1. Чтобы просмотреть все задачи для конретного расписания пользователя, клиент(фронтенд) на адрес *https://{domain}/tasks/get_in_timetable/for_user* передаёт:
    - “timetable_id”
    - access token
2. Затем бэкенд:
    - Проверяет, есть ли переданное расписание у пользователя;
    если нет, то вызывает ошибку 404;
3. В конце бэкенд отдаёт клиенту(фронтенду):
    - “tasks”
    (список из задач для пользователя в этом расписании)
        - “id_timetable”
        (id расписания)
        - “description”
        (описание задачи)
        - “deadline”
        (срок, до которого нужно выполнить задачу)
        - “subject”
        (предмет, для которого нужно выполнить задачу)
        - “id”
        (id задачи)
        - “tag”
        (тэг задачи: “один” или “все”)
        - “status”
        (статус выполнения задачи пользователем: “В процессе” или “Завершено”)
        - “creation_date”
        (дата создания задачи)

### Просмотр всех задач старостой для конкретного расписания
(Видны статусы всех пользователей для каждой задачи)

1. Чтобы просмотреть все задачи старостой для конретного расписания, клиент(фронтенд) на адрес *https://{domain}/tasks/get_in_timetable/for_elder* передаёт:
    - “timetable_id”
    - access token
2. Затем бэкенд:
    - Проверяет, есть ли переданное расписание у пользователя;
    если нет, то вызывает ошибку 404;
    - Проверяет, является ли пользователь старостой в этом расписании ;
    если нет, то вызывает ошибку 403;
3. В конце бэкенд отдаёт клиенту(фронтенду):
    - “tasks”
    (список из задач для старосты в этом расписании)
        - “id_timetable”
        (id расписания)
        - “description”
        (описание задачи)
        - “deadline”
        (срок, до которого нужно выполнить задачу)
        - “subject”
        (предмет, для которого нужно выполнить задачу)
        - “id”
        (id задачи)
        - “tag”
        (тэг задачи: “один” или “все”)
        - “creation_date”
        (дата создания задачи)
        - “statuses”
        (список из статусов для задачи)
            - “id”
            - “id_user”
            (id пользователя)
            - “status”
            (”В процессе” или “Завершено”)
            - “email”
            (почта пользователя)
            - “first_name”
            (имя пользователя)
            - “last_name”
            (фамилия пользователя)

### Просмотр всех задач пользователем для всех расписаний пользователя
(Видны только задачи для пользователя во всех его расписаниях)

**1 Вариант**

Чтобы просмотреть все задачи пользователя, клиент(фронтенд) может обратиться на адрес *https://{domain}/users/me* 

(Больше информации: USER - Информация о пользователе - Просмотр информации)

**2 Вариант**

1. Чтобы просмотреть все задачи пользователя, клиент(фронтенд) на адрес *https://{domain}/tasks/get_all* передаёт:
    - access token
2. Затем бэкенд:
    - получает информацию о пользователе с помощью токена
3. В конце бэкенд отдаёт клиенту(фронтенду):
    - “tasks”
    (список из задач для пользователя)
        - “id_timetable”
        (id расписания)
        - “description”
        (описание задачи)
        - “deadline”
        (срок, до которого нужно выполнить задачу)
        - “subject”
        (предмет, для которого нужно выполнить задачу)
        - “id”
        (id задачи)
        - “tag”
        (тэг задачи: “один” или “все”)
        - “status”
        (статус выполнения задачи пользователем: “В процессе” или “Завершено”)
        - “creation_date”
        (дата создания задачи)

### Просмотр всех задач пользователем для конкретного расписания на конкретную дату (для тг)

1. Чтобы просмотреть все задачи на конкретную дату для конретного расписания пользователя, клиент(фронтенд) на адрес *https://{domain}/tasks/filter* передаёт:
    - “timetable_id”
    - access token
2. Затем бэкенд:
    - Проверяет, есть ли переданное расписание у пользователя;
    если нет, то вызывает ошибку 404;
    - Берет из БД задачи на конкретную дату для конкретного расписания и пользователя;
    если задач нет, то вызывает ошибку 404;
3. В конце бэкенд отдаёт клиенту(фронтенду):
    - “tasks”
    (список из задач для пользователя в этом расписании)
        - “id_timetable”
        (id расписания)
        - “description”
        (описание задачи)
        - “deadline”
        (срок, до которого нужно выполнить задачу)
        - “subject”
        (предмет, для которого нужно выполнить задачу)
        - “id”
        (id задачи)
        - “tag”
        (тэг задачи: “один” или “все”)
        - “status”
        (статус выполнения задачи пользователем: “В процессе” или “Завершено”)
        - “creation_date”
        (дата создания задачи)

## Изменение задачи

### Изменение статуса задачи для одного пользователя в расписании

1. Чтобы изменить статус задачи пользователя, клиент(фронтенд) на адрес *https://{domain}/tasks/update/status* передаёт:
    - “task_id”
    (id задачи)
    - “task_status”
    (”В процессе” или “Завершено”)
    - access token
2. Затем бэкенд:
    - Проверяет, есть ли у пользователя переданная задача;
    если нет, то вызывает ошибку 404;
    - Обновляет статус пользователя в переданной задаче.

### Изменение задачи в расписании

1. Чтобы изменить информацию в задаче пользователя, клиент(фронтенд) на адрес *https://{domain}/tasks/update/info* передаёт:
    - “task_data”
    (данные для изменения информации в задаче)
        - “id_timetable”
        (id расписания)
        - “description”
        (описание задачи)
        - “deadline”
        (срок, до которого нужно выполнить задачу)
        - “subject”
        (предмет, для которого нужно выполнить задачу)
        - “id”
        (id задачи)
    - access token
2. Затем бэкенд:
    - Проверяет, есть ли в БД такая задача;
    если нет, то вызывает ошибку 404;
    - Проверяет, совпадают ли переданный id расписания с полученным из БД;
    если нет, то вызывает ошибку 404;
    - Проверяет, есть ли у пользователя такая задача;
    если нет, то вызывает ошибку 404;
    - Проверяет, какой тег у задачи;
    - Если тег равен “все” , то проверяет, есть ли переданное расписание у пользователя;
    если нет, то вызывает ошибку 404;
    - Если тег равен “все” , то проверяет, является ли пользователь старостой в этом расписании ;
    если нет, то вызывает ошибку 403;
    - обновляет информацию в задаче в БД.

## Удаление задачи

### Удаление задачи в расписании

1. Чтобы удалить задачу клиент(фронтенд) на адрес *https://{domain}/task/delete* отправляет:
    - “task_id”
    (id задачи)
    - access token
2. Затем бэкенд:
    - Получает задачу, которую нужно удалить, из БД;
    если такой задачи в БД нет, то вызывает ошибку 404;
    - Проверяет, есть ли у данного пользователя расписание, которое прикреплено к задаче, которую нужно удалить;
    если нет, то вызывает ошибку 404;
    - Проверяет, является ли пользователь старостой в расписании или прикреплена ли к пользователю задача, которую нужно удалить, и является ли эта задача только для данного пользователя (т.е. тег этой задачи должен быть равен “один”);
    если оба условия не выполняются, то вызывает ошибку 403;
    - Удаляет задачу.

### Удаление выполненных задач пользователя в расписании

1. Чтобы удалить все выполненные задачи в расписании (все задачи, предназначенные только для данного пользователя, т.е. задачи, у которых тег равен “один”) клиент(фронтенд) на адрес *https://{domain}/task/delete/complited* передает:
    - “timetable_id”
    (id расписания)
    - access token
2. Затем бэкенд:
    - Проверяет, есть ли переданное расписание у пользователя;
    если нет, то вызывает ошибку 404;
    - Получает все выполненные задачи пользователя в расписании (все задачи, предназначенные только для данного пользователя, т.е. задачи, у которых тег равен “один”);
    если таких задач нет, то вызывает ошибку 404;
    - Удаляет все полученные задачи.